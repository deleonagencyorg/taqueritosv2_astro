<!-- src/views/Home/index.astro -->
---
import LazyImage from '../../components/common/LazyImage.astro';
// Component Imports
import Carousel from '../../components/common/Carousel/index.astro';
import RecipeCard from '../../components/recipes/RecipeCard.astro';
import RecipesCarousel from "../../components/recipes/RecipesCarousel.astro";
import Newsletter from '../../components/common/Newsletter/index.astro';
import FloatingChip from '../../components/common/FloatingChip/index.astro';
import SocialMediaIcons from '../../components/common/SocialMediaIcons/index.astro';
import NewProductsCarousel from '../../components/common/NewProductsCarousel/index.astro';
import SimpleProductCarousel from '../../components/common/SimpleProductCarousel/index.astro';
import ProductsCarousel from '../../components/common/ProductsCarousel/index.astro';

// Style Imports
import './styles.css';

// i18n and Data Imports
import { t, getLocale } from '../../i18n/i18n';
import type { Locale } from '../../i18n/i18n';

// Recipe interface definition
interface RecipeItem {
  id: string;
  title: string;
  description?: string;
  ingredients: string[];
  instructions: string[];
  preparation_time: number;
  servings?: number;
  image?: string;
  product_image?: string;
  tags?: string[];
}

// Helper function to get recipes by brand
function getRecipesByBrand(recipes: RecipeItem[], brand: string): RecipeItem[] {
  return recipes.filter(recipe => 
    recipe.tags?.some(tag => tag.toLowerCase().includes(brand.toLowerCase()))
  );
}

// Props
export interface Props {
  loading?: boolean;
}
const { loading = false } = Astro.props;

// Language and Data Setup
const currentLang = getLocale();
const homeAssets = t('home', { namespace: 'common', locale: currentLang }) || {};
const recipesAssets = t('', { namespace: 'recipes', locale: currentLang }) || {};
const recipeItems: RecipeItem[] = getRecipesByBrand(recipesAssets.items || [], 'zibas');
const galleryAssets = t('', { namespace: 'gallery', locale: currentLang }) || {};

const mappedModalLabels = {
  close: galleryAssets?.modal?.closeLabel || 'Cerrar',
  previous: galleryAssets?.modal?.prevLabel || 'Anterior',
  next: galleryAssets?.modal?.nextLabel || 'Siguiente'
};

const brands = t('brands', { namespace: 'brands', locale: currentLang }) || [];
const zibasBrand = brands.find((brand: any) => brand.id === 'zibas');
const zibasProducts = zibasBrand?.products || [];

const commonAssets = t('assets.slider', { namespace: 'common', locale: currentLang }) || [];
const slides = Array.isArray(commonAssets) 
  ? commonAssets
    .filter(asset => asset && typeof asset === 'object' && asset.desktop && asset.mobile)
    .map(asset => ({
      desktop: asset.desktop,
      mobile: asset.mobile,
      alt: asset.alt || 'Snacks Yummies',
      title: asset.title || '',
      subtitle: asset.description || '',
      link: asset.url || asset.link || ''
    }))
  : [];



---

  <main class="w-full flex flex-col items-center justify-center mt-0">
    <!-- Slider Section con máscara -->
    <div class="relative w-full overflow-hidden max-w-[100vw] h-auto aspect-[1/1] md:aspect-[21/9] lg:h-[66vh]">
     

      <div class="relative z-0 w-full md:w-[100%] md:ml-auto md:h-full h-[72vh] md:flex md:items-center md:justify-center">
        <Carousel slides={slides} />
      </div>
    </div>
    
    <!-- Sección de Productos Zibas -->
    {zibasProducts.length > 0 && (
      <section class="w-full py-16 bg-blue">
        <div class="container mx-auto px-4">
          <ProductsCarousel 
            products={zibasProducts}
            title={currentLang === 'es' ? 'DESCUBRE LA VARIEDAD DE NUESTROS' : 'Our Zibas Products'}
            description={currentLang === 'es' ? 'PRODUCTOS' : 'Discover the delicious variety of Zibas chips with unique flavors'}
            color={'white'}
            autoplay={true}
            speed={4000}
            slidesPerView={3}
            spaceBetween={30}
            loop={true}
            className="max-w-7xl mx-auto"
          />
        </div>
      </section>
    )}
    
 


    <!-- Sección de recetas con carrusel -->
    <section id="recipes" class="w-full py-12" transition:animate="slide">
      <div class="container mx-auto px-4">
        <RecipesCarousel 
          recipes={recipeItems} 
          title={recipesAssets.home?.title || 'DESCUBRE NUEVOS SABORES CON NUESTRAS'}
          textButton={recipesAssets.home?.view_more || 'Ver Todas'}
        />
      </div>
    </section>


    <!-- Sección Gallery -->
    <section id="gallery" class="bg-pink w-full py-12" transition:animate="slide">
      <div class="container mx-auto px-4">
        <div class="text-center mb-8">
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
            {galleryAssets.title || 'Gallery'}
          </h2>
        </div>
        
      </div>
    </section>

    <!-- Sección News -->

    <!-- Sección Abaout -->






  </main>
